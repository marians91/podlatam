apiVersion: networking.istio.io/v1alpha3
kind: Sidecar
metadata:
  name: istio-proxy-config
spec:
  egress:
  - hosts:
    - "./*"
    - "istio-system/*"
    # common services route
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.catalogUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.events.catalogUrlPrefix }}.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.catalogUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.sidecar.fluentdHostPrefix }}.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.sidecar.fluentdHostPrefix }}-log.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.sidecar.fluentdHostPrefix }}-audit.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.sidecar.fluentdHostPrefix }}-event.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.sidecar.fluentdHostPrefix }}-metric.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.sidecar.fluentdHostPrefix }}-systemlog.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.sidecar.fluentdHostPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.asyncResultUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.events.asyncResultUrlPrefix }}.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.asyncResultUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.commonEventUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.events.commonEventUrlPrefix }}.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.commonEventUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.schemaRegistryUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.events.schemaRegistryUrlPrefix }}.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.schemaRegistryUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
    - "{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.schedulerEventsUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}/{{ .Values.events.schedulerEventsUrlPrefix }}.{{ .Values.deploy.sc }}-{{ .Values.deploy.apm_code }}{{ .Values.events.schedulerEventsUrlPostfix }}-{{ .Values.deploy.env }}-{{ .Values.developer.urlPostfix }}.{{ .Values.commonServices.clusterDNSsuffix }}"
